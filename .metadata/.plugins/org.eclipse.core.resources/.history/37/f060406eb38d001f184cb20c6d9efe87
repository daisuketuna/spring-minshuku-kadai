package com.example.samuraitravel.service;

import org.springframework.stereotype.Service;

import com.example.samuraitravel.form.ReservationRegisterForm;
import com.stripe.Stripe;
import com.stripe.exception.StripeException;
import com.stripe.model.checkout.Session;
import com.stripe.param.checkout.SessionCreateParams;

import jakarta.servlet.http.HttpServletRequest;

@Service
public class StripeService {
	//セッションを作成し、Stripeに必要な情報を返す
	public String createStripeSession(String houseName,ReservationRegisterForm reservationRegisterForm,HttpServletRequest httpServletRequest) {
		Stripe.apiKey = "sk_test_51Q9M9fD3g0tYePWj29gRbFHhy98w23gOTABNLPUQvTmNBXyvhgckRUFeHUqbxCdogqRUfTvN1w9krgwiXJ4S8itz00kCDY4aM4";
		String requestUrl = new String(httpServletRequest.getRequestURL());
		SessionCreateParams params =
				SessionCreateParams.builder()
					.addPaymentMethodType(SessionCreateParams.PaymentMethodType.CARD)
					.addLineItem(
						SessionCreateParams.LineItem.builder()
							.setProductData(
								SessionCreateParams.LineItem.PriceData.ProductData.builder()
									.setName(houseName)
									.build())
							.setUnitAmount((long)reservationRegisterForm.getAmount())
							.setCurrency("jpy")
							.build())
					.setQuantity(1L)
					.build())
				.setMode(Session)
	}
}
